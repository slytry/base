---
aliases: null
date created: 2022-01-21 18:25
date updated: 2022-01-21 18:33
---

WeakMap и WeakSet - это особенные map и set.

Основная особенность в том, что эти методы не блокируют сборщие мусора.
Ссылки на объекты хранящиеся в map и set  не дадут объекту удалиться. Пока объект остается достижимым он не удаляется.

При использовании WeakMap и WeakSet сборщик мусора автоматически удалит ссылки на объекты хранящиеся в этих сущностях если нигде кроме не останется других ссылок.

### WeakMap

В `WeakMap` в отличие от `Map`  ключи должны быть только объектами, а не примитивами.
`WeakMap` не поддерживает перебор и методы `keys()`, `values()`, `entries()`, так что нет способа взять все ключи или значения из неё.

В `WeakMap` присутствуют только следующие методы:

- `weakMap.get(key)`
- `weakMap.set(key, value)`
- `weakMap.delete(key)`
- `weakMap.has(key)`

Невозможность переборы вытекая из особенносте работы движка js. Не извсто в какой именно момент он решит удалить свойства из коллекции. То есть не известо сколько свойства хранитсья внутьри в определенный момент времени.

### Использование
В основном, `WeakMap` используется в качестве _дополнительного хранилища данных_.

Когда мы хотим сохранить данные для какого-то объекта который будет существовать не всегда. Например при пересчете поситителей. Если при их уходе соответвующая заметка не будет автоматически удаляться, хранилище будет беспонечно расти.

**Применяется для кэширования**
Другая частая сфера применения – это кеширование, когда результат вызова функции должен где-то запоминаться («кешироваться») для того, чтобы дальнейшие её вызовы на том же объекте могли просто брать уже готовый результат, повторно используя его.

### WeakSet
Коллекция `WeakSet` ведёт себя похоже:

-   Она аналогична `Set`, но мы можем добавлять в `WeakSet` только объекты (не примитивные значения).
-   Объект присутствует в множестве только до тех пор, пока доступен где-то ещё.
-   Как и `Set`, она поддерживает `add`, `has` и `delete`, но не `size`, `keys()` и не является перебираемой.

Будучи «слабой» версией оригинальной структуры данных, она тоже служит в качестве дополнительного хранилища. Но не для произвольных данных, а скорее для значений типа «да/нет». Присутствие во множестве `WeakSet` может что-то сказать нам об объекте.

Наиболее значительным ограничением `WeakMap` и `WeakSet` является то, что их нельзя перебрать или взять всё содержимое. Это может доставлять неудобства, но не мешает `WeakMap/WeakSet` выполнять их главную задачу – быть дополнительным хранилищем данных для объектов, управляемых из каких-то других мест в коде.

---

###### Citation

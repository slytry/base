---
tags: 
aliases: 
---
#### Gulp
```
npm i -g gulp-cli 
npm i -D gulp
```
### Проблемы
**gulp ограничения по ES6 модулям на 27.12.21** 
1. Нельзя импортировать директории.  
Такой способ описан на сайте самого[ галпа](https://gulpjs.com/docs/en/getting-started/javascript-and-gulpfiles#:~:text=gulpfile%20transpilation%20documentation.-,Splitting%20a%20gulpfile,-%23).  Это когда пишет путь к папке, внутри есть файл index.js, он автоматически определяется как точка входа. Такой функционал [только планируется ](https://nodejs.org/api/esm.html#esm_mandatory_file_extensions)в node.js. Эта проблема решается babel-ем или экспериментальным флагом.
2. Нельзя сразу импортировать методы из gulp массивом. Надо использовать gulp целиком как объект. Это никак не обойти. Gulp сам по себе является ComonJs модулем. Про этой же причине не работает плагин  подгрузки других плагинов (gulp-load-plugins), но и без него нормально. Эта проблема решается babel-ем

#### Супер флаг. Решение встроенным средством.
Чтобы нода понимала ES модули надо в package указать тип модулей. По умолчанию это CJS
```json
"type": "module",
```
Важно прописывать полный путь до файла вместе с расширением. 
Импорт каталогов не работает. ( не получится спрятать gulpfile)

Если добавить флаг, то можно использовать импорт каталогов. Что означает просто спрятать gulpfile в папку
```json
gulp --es-module-specifier-resolution=node --trace-warnings
```
--trace-warnings конкретное место ошибки
#### Чтобы все заработало, как надо, надо babel
##### Что дает 
1. Работает плагин для обобщение всех плагиновgulp-load-plugins
2. Можно использовать импорт из директорий, без флага.
>Работают любые фантазии но увеличивает скорость работы 1.3 секунды. 60 раз запущу 1.20 лишние уйдут.

##### Установка
1. Установить babel и пресет для работы последнего ES
`npm i -D @babel/core @babel/register @babel/preset-env`
2. Добавить пресет в package.json (либо создать файл .babelrc. На выбор) и брузерлист
```json
"babel": {
	"presets": [
	"@babel/preset-env"
	]
},
"browserslist": [
    "> 1%",
    "last 2 versions",
    "not dead",
    "not IE 11"
  ],
```
3. Добавить в ESlint
```json
"parser": "@babel/eslint-parser",
```

Итого:
![[Pasted image 20211231234248.png]]

Любое усложнение сильно замедляет работу. Сикретный флаг не дает никаких преимуществ кроме эстетического и при этом его надо будет вводить каждый раз. Так как скрипт через npm забирает больше секунды. Бабель дает реальные преимущества в функциональность: деструктуризация, плагин, импорт каталогом, и решение всех будущих проблем, но замедляет на 1.3 секунды. Так же не известна влияние разрастания кода??? Готов пожертвовать деструктуризацией ради скорости)
Дополнение: На большой готовой сборке разница между babel и без около 1.6-1.9с. С увеличением кода сборка работает все медленней.
![[Pasted image 20220101115233.png]]

---
###### Citation
Date: 2021-12-27T21:32
npm r -S @babel/core @babel/register @babel/preset-env
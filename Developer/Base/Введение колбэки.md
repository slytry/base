---
aliases: null
date created: 2022-01-22 17:10
date updated:
---

Многие действия в JavaScript _асинхронные_. 

Это значит что код не ждет выполнение другого кода, он просто выполняется парралельно. Такое поведение может приводить в проблемам. Напривер, вызов функции из скрипта, который не прогрузился.

### Колбэк

Первый способ решения подобной проблемы это передача одной ф-и как параметр другой ф-и. Такая ф-я называется _callback_

```js 
function loadScript(src, callback) {
  let script = document.createElement('script');
  script.src = src;

  script.onload = () => callback(script);

  document.head.append(script);
}
```

Смысл такой: вторым аргументом передаётся функция (обычно анонимная), которая выполняется по завершении действия.

Такое написание называют асинхронным программированием с использованием колбэков. В функции, которые выполняют какие-либо асинхронные операции, передаётся аргумент `callback` — функция, которая будет вызвана по завершению асинхронного действия.

### Колбэк в колбэке

Основная проблеммв такого подхода в ограниченности колличества последовательного ряда. То есть он не ограничем, но очень большая вложенность делает код не читабельным.
Такие вложенности появляеются когда надо сделать несколько дейтсвий последовательно. Например, заргужить нескольо скриатов последовательно

```js
loadScript('/my/script.js', function(script) {

  loadScript('/my/script2.js', function(script) {

    loadScript('/my/script3.js', function(script) {
      // ...и так далее, пока все скрипты не будут загружены
    });

  })

});
```

Если сюда добавить обработку ошибок и реальный код, и все это растет в право... Можно разбить на отдельные ф-и, но это не решает проблему, читать такой код по прежнему не удобно, и такие ф-и будет одноразовые. Такой подход не приветствуется

Такая проблема решается промиссами.

### Перехват ошибок
А что если загрузить скрипт не удалось? Колбэк должен уметь реагировать на возможные проблемы.

Ниже улучшенная версия `loadScript`, которая умеет отслеживать ошибки загрузки:


```js
loadScript('/my/script.js', function(error, script) {
  if (error) {
    // обрабатываем ошибку
  } else {
    // скрипт успешно загружен
  }
});
```

Подход в `loadScript`, также распространён и называется «колбэк с первым аргументом-ошибкой» («error-first callback»).

Правила таковы:

1.  Первый аргумент функции `callback` зарезервирован для ошибки. В этом случае вызов выглядит вот так: `callback(err)`.
2.  Второй и последующие аргументы — для результатов выполнения. В этом случае вызов выглядит вот так: `callback(null, result1, result2…)`.

Одна и та же функция `callback` используется и для информирования об ошибке, и для передачи результатов.


---

###### Citation


```js

```